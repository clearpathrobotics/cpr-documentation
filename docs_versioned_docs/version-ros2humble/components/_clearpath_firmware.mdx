import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

:::caution

Before flashing firmware, place your robot up on blocks or disengage the drivetrain. Firmware loading does not usually result in unintended motion, but it is safest when off the ground.

:::


<Tabs groupId="platform">
  <TabItem
    value="J100"
    label="J100"
  >


  #### 1. Download the Clearpath Firmware package from the Clearpath package server

  On the robot computer, run the following commands:

  ```
  sudo apt-get update
  sudo apt-get install ros-humble-clearpath-firmware
  ```

  #### 2. Prepare the Robot

:::note

  Platforms with an Ethernet connection to the MCU have the option of flashing over USB or Ethernet.
  If you are updating to ROS 2 Humble for the first time, you must use USB. If you are updating ROS 2 Humble firmware
  to a newer version, using Ethernet is recommended. Skip this step if flashing over Ethernet.

:::

  The J100 MCU is mounted to the rear inside wall of the robot. To access it, open the lid, keeping the computer
  tray secured to the underside of the lid.

  <center>
    <figure>
      <img
        src="/img/robot_images/jackal_images/mcu-annotated.jpg"
        width="800"
      />
      <figcaption>J100 MCU</figcaption>
    </figure>
  </center>


  <figure>
    <figcaption><b>J100 MCU labels</b></figcaption>
    <ol>
      <li>
      The <code>M_RST</code> button, used to reset the MCU.
      </li>
      <li>
        The <code>PWR_MODE</code> switch. Left is <code>NORM</code> or normal mode, right is <code>ALT</code> or bootloader mode. This is used for flashing the firmware.
      </li>
      <li>
        The mini-USB port used for transmitting data. This should be connected to J100's computer for both normal operation and  firmware flashing.
      </li>
    </ol>
  </figure>

  **Place the J100 MCU into bootloader mode**

  Open the lid of the robot to expose the MCU and make sure the mini-USB cable is connected to the robot computer.
  Switch the <code>PWR_MODE</code> switch from <code>NORM</code> to <code>ALT</code>. If the robot is on, press the <code>M_RST</code> button. Otherwise, turn the robot on with the power button.

  </TabItem>

  <TabItem
    value="W200"
    label="W200"
    default
  >

  #### 1. Download the Clearpath Firmware package from the Clearpath package server

  On an external computer, run the following commands:

  ```
  sudo apt-get update
  sudo apt-get install ros-humble-clearpath-firmware
  ```

  #### 2. Prepare the Robot

:::note

  Platforms with an Ethernet connection to the MCU have the option of flashing over USB or Ethernet.
  If you are updating to ROS 2 Humble for the first time, you must use USB. If you are updating ROS 2 Humble firmware
  to a newer version, using Ethernet is recommended. Skip this step if flashing over Ethernet.

:::

  The W200 MCU is located on the underside of the metal frame over the top of the computer.

  <center>
    <figure>
      <img
        src="/img/robot_images/warthog_images/mcu_buttons.jpg"
        width="800"
      />
      <figcaption>W200 MCU</figcaption>
    </figure>
  </center>


  <figure>
    <figcaption><b>W200 MCU labels</b></figcaption>
    <ul>
      <li>
      The <code>RST</code> button, used to reset the MCU.
      </li>
      <li>
        The <code>BT0</code> button, used to enter the USB bootloader mode.
      </li>
    </ul>
  </figure>

  **Place the W200 MCU into bootloader mode**

  While pressing <code>BT0</code> on the MCU, connect the external computer to Warthog's MCU using a USB cable.

  </TabItem>

  <TabItem
    value="R100"
    label="R100"
    default
  >

  #### 1. Download the Clearpath Firmware package from the Clearpath package server

  On the robot computer, run the following commands:

  ```
  sudo apt-get update
  sudo apt-get install ros-humble-clearpath-firmware
  ```

  #### 2. Prepare the Robot

:::note

  Platforms with an Ethernet connection to the MCU have the option of flashing over USB or Ethernet.
  If you are updating to ROS 2 Humble for the first time, you must use USB. If you are updating ROS 2 Humble firmware
  to a newer version, using Ethernet is recommended. Skip this step if flashing over Ethernet.

:::

  Place the R100 Ridgeback up on blocks. Firmware loading does not usually result in unintended motion, but it's safest when off the ground.

  Remove the side panels to access the robot computer and MCU.

  Connect the MCU to the R100 Ridgeback's onboard computer using a mini-USB cable connected to the port shown below:

  <center>
    <figure>
      <img
        src="/img/robot_images/ridgeback_images/mcu_usb.png"
        width="800"
      />
      <figcaption>R100 MCU mini-USB port</figcaption>
    </figure>
  </center>

  In the middle of the MCU, there is a two-position switch labelled `PWR_MODE`. Move the switch from the default `NORM` position to the `AUX` position.

  Press the `M_RST` to restart the MCU. Now, the MCU is in boot-loader mode, ready to receive new firmware.

  <center>
    <figure>
      <img
        src="/img/robot_images/ridgeback_images/mcu_buttons.png"
        width="800"
      />
      <figcaption>R100 MCU mode switch and reset button</figcaption>
    </figure>
  </center>

:::note

The Ridgeback's MCU is normally rotated 90 degrees when it is installed in the robot; the `NORM` position is typically towards the top of the robot's chassis and the `AUX` position is normally towards the bottom.

:::

  </TabItem>

  <TabItem
    value="DX100"
    label="DX100"
    default
  >

  #### 1. Download the Clearpath Firmware package from the Clearpath package server

  On the robot computer, run the following commands:

  ```
  sudo apt-get update
  sudo apt-get install ros-humble-clearpath-firmware
  ```

  #### 2. Prepare the Robot

:::note

  Platforms with an Ethernet connection to the MCU have the option of flashing over USB or Ethernet.
  If you are updating to ROS 2 Humble for the first time, you must use USB. If you are updating ROS 2 Humble firmware
  to a newer version, using Ethernet is recommended. Skip this step if flashing over Ethernet.

:::

  The DX100 MCU is mounted near the HMI panel towards the rear of the robot. To access it, remove the antennas and the center channel panel.

  Connect the MCU to the onboard computer using a mini-USB cable connected to the port as shown below:

  <center>
    <figure>
      <img
        src="/img/robot_images/dingo_images/dingo-d-100-bootloader.jpg"
        width="800"
      />
      <figcaption>DX100 MCU mini-USB port</figcaption>
    </figure>
  </center>

  As is shown in the image above, set the `PWR_MODE` switch to the `ALT` position.

  Press the `M_RST` or restart the robot using the HMI panel. Now, the MCU is in boot-loader mode, ready to receive new firmware.

  </TabItem>

  <TabItem
    value="DX150"
    label="DX150"
    default
  >

  #### 1. Download the Clearpath Firmware package from the Clearpath package server

  On the robot computer, run the following commands:

  ```
  sudo apt-get update
  sudo apt-get install ros-humble-clearpath-firmware
  ```

  #### 2. Prepare the Robot

:::note

  Platforms with an Ethernet connection to the MCU have the option of flashing over USB or Ethernet.
  If you are updating to ROS 2 Humble for the first time, you must use USB. If you are updating ROS 2 Humble firmware
  to a newer version, using Ethernet is recommended. Skip this step if flashing over Ethernet.

:::

  The DX150 MCU is mounted near the HMI panel towards the rear of the robot. To access it, remove the antennas and the center channel panel.

  Connect the MCU to the onboard computer using a mini-USB cable connected to the port as shown below:

  <center>
    <figure>
      <img
        src="/img/robot_images/dingo_images/dingo-d-150-bootloader.jpg"
        width="800"
      />
      <figcaption>DX150 MCU mini-USB port</figcaption>
    </figure>
  </center>

  As is shown in the image above, set the `PWR_MODE` switch to the `ALT` position.

  Press the `M_RST` or restart the robot using the HMI panel. Now, the MCU is in boot-loader mode, ready to receive new firmware.

  </TabItem>
</Tabs>


#### 3. Flash the firmware

Run the Clearpath firmware flash tool:

```
source /opt/ros/humble/setup.bash
ros2 run clearpath_firmware flash
```

Select your platform, then select which method of flashing you would like to use.

:::caution

Do not turn the robot off or unplug the cable while flashing firmware. If an error occurs while
flashing, you can attempt to flash again over USB.

:::

#### 4. Place the robot back into normal operating mode

:::note

If you flashed over Ethernet, skip this step.

:::

<Tabs groupId="platform">
  <TabItem
    value="J100"
    label="J100"
  >

  Switch the <code>PWR_MODE</code> switch from <code>ALT</code> back to <code>NORM</code>. The robot will turn off.
  Power it back on with the power button.

  </TabItem>

  <TabItem
    value="W200"
    label="W200"
    default
  >

  Press the <code>RST</code> button. The MCU should enter regular operation.

  </TabItem>

  <TabItem
    value="R100"
    label="R100"
  >

  Switch the <code>PWR_MODE</code> switch from <code>ALT</code> back to <code>NORM</code>. The robot will turn off.
  Power it back on with the power button.

  </TabItem>


  <TabItem
    value="DX100"
    label="DX100"
  >

  Switch the <code>PWR_MODE</code> switch from <code>ALT</code> back to <code>NORM</code>. The robot will turn off.
  Power it back on with the power button.

  </TabItem>


  <TabItem
    value="DX150"
    label="DX150"
  >

  Switch the <code>PWR_MODE</code> switch from <code>ALT</code> back to <code>NORM</code>. The robot will turn off.
  Power it back on with the power button.

  </TabItem>

</Tabs>
