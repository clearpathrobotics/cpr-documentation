---
title: Navigation Features
sidebar_label: Navigation Features
sidebar_position: 1
toc_min_heading_level: 2
toc_max_heading_level: 4
---

:::danger SAFETY WARNING

Making changes to any of the following variables may cause system safety concerns. It is recommended that users
only modify these parameters in consultation with CPR.

:::

:::note

Changes to any of the following variables will only take effect after power cycling the robot.

:::

The OutdoorNav Software contains a set of features that can be enabled
or disabled according to your required application requirements. These
features can be enabled or disabled through the use of environment
variables, which should be added to the
`~/cpr_outdoornav_launch/env/autonomy_customization.env` file. The
following table describes the available features, their default state
and any additional parameters that we expose that may also be included
to tune the feature.

| Feature     | Description                                            |
|-----------------------------|----------------------------------------|
| **Data Collection**         | The data collection feature enabled the user to record rosbag data of the sensors, localization, and  navigation components of OutdoorNav. If `true`,  rosbags will be saved and timestamed in the `~/onav_log/rosbag_data/` directory. If `false`, no rosbag will be recorded.<br/><br/>Environment Variable: `ENABLE_BAGGING` (Default: `false`). |
| **Collision Avoidance**     | Collision avoidance is the UGV's ability to detect obstacles and stop/maneuver around the obstacle without any collisions. If `true`, the UGV will detect obstacles and if `false` no obstacles will be detected. Setting to `false` is not recommended and may cause harm to property or to individuals.<br/><br/>Environment Variable: `ENABLE_COLLISION_AVOIDANCE` (Default: `true`). |
| **Obstacle Avoidance Mode** | When collision avoidance is enabled, the UGV will behave in one of two ways according to the obstacle avoidance mode. If set to `true`, the UGV will perform obstacle avoidance maneuvers, replanning around detected obstacles. If set to `false`, the UGV will slow down to a stop in front of detected obstacles and wait for the obstacle to clear before proceeding.<br/><br/>Environment Variable: `OBSTACLE_AVOIDANCE_MODE` (Default: `true`). |
| **Continuous Planning**     | The continuous planning feature allows the UGV to continuously monitor whether an obstacle is on the UGV's path and replan around said obstacle smoothly without the need for stopping in front of the obstacle. If disabled, the UGV will come to a full stop in front of an obstacle and then replan around said obstacle.<br/><br/>Environment Variable: `ENABLE_CONTINUOUS_PLANNER` (Default: `true`). |
| **Path Smoothing**          | The path smoothing feature according to a specified turning radius. The default behaviour will generate point-to-point straight line paths.<br/><br/>Environment Variable: `ENABLE_PATH_SMOOTHER` (Default: `false`). |
| **Path Shifting**           | The path shifting feature is designed to reduce the oscillation around the initial reference path if the UGV begins to deviate of said reference path. It is particularly useful for the Clearpath Robotics Warthog platform whose tires are incredibly pliable and results in unmodelled effects on the navigation.<br/><br/>Environment Variable: `ENABLE_PATH_SHIFTING` (Default: `false`). |
| **Constrained Replanning**  | The constrained replanning feature restricts the area in which replanning paths can be generated. For example, if a `REPLANNING_CONSTRAINT` of 3.0 m is used, the UGV will not be allowed to replan a path that drives it more than 3.0 m from the initial path. This replanning area can be shown on the map over the connecting lines between waypoints. See [Constrained Replanning](../web_user_interface/ui_autonomous_mode#constrained_path) for further details.<br/><br/>Environment Variable: `ENABLE_CONSTRAINED_REPLANNING` (Default: `false`).<br/><br/>Use the `REPLANNING_CONSTRAINT` environment variable to modify the replanning constraint (in meters). |
| **Stop Distance**           | The stop distance feature allows the UGV to stop a predefined distance away from obstacles. This is useful if a UGV cannot drive in reverse and needs the required room in front of it to replan around an obstacle.<br/><br/>Environment Variable: `ENABLE_STOP_DISTANCE` (Default: `false`)<br/><br/>Use the `STOP_DISTANCE` environment variable to modify the stop distance (in meters). Note that if the stop distance is larger than 4.5 meters for the Clearpath Robotics Jackal and Husky UGVs, or 10.0 meters for the Clearpath Robotics Warthog UGV, the computational load will increase and may cause a decrease in performance in the navigation. |
| **Delay Compensation**      | The delay compensation feature is able to compensate for mechanical delay on UGVs where either the accelerator introduces delay into the linear velocity or the steering introduces delay in the angular velocity. This feature is not required for Clearpath Robotics UGVs as negligible delay is present in our system.<br/><br/>Environment Variable: `ENABLE_DELAY_COMPENSATION` (Default: `false`)<br/><br/>Use the `CONTROLLER_DELAY` environment variable to modify the amount of delay to be compensated (in milliseconds). |

## Advanced Configuration

The following section provides a list of environment variables that can
be modified in order to tune both the sensor systems as well as tuning
the navigation software. All of the environment variables listed below
can be modified in the
`~/cpr_outdoornav_launch/env/autonomy_customization.env` file.

### Navigation Tuning

The following table lists the environment variables that can be used to
enable/disable which sensor is used as part of the collision avoidance
feature of OutdoorNav.

| Environment Variable | Description                              | Data Type |
|----------------------|------------------------------------------|-----------|
| **VLP_ENABLE_COSTMAP** | Enable/disable the Velodyne from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (front unit if more than one). | bool |
| **REAR_VLP_ENABLE_COSTMAP** | Enable/disable the Velodyne from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (rear unit if more than one). | bool |
| **LMS1XX_ENABLE_COSTMAP** | Enable/disable the Sick LMS1XX from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (front unit if more than one). | bool |
| **REAR_LMS1XX_ENABLE_COSTMAP** | Enable/disable the Sick LMS1XX from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (rear unit if more than one). | bool |
| **HOKUYO_ENABLE_COSTMAP** | Enable/disable the Hokuyo from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (front unit if more than one). | bool |
| **REAR_HOKUYO_ENABLE_COSTMAP** | Enable/disable the Hokuyo from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (rear unit if more than one). | bool |
| **D435_ENABLE_COSTMAP** | Enable/disable the Realsense from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (front unit if more than one). | bool |
| **REAR_D435_ENABLE_COSTMAP** | Enable/disable the Realsense from populating the costmap and being used for collision avoidance. This variable should only be used if the sensor is integrated (rear unit if more than one). | bool |

### Navigation Tuning (Advanced)

The following list of environment variables can be used to modify some
of the navigation inputs of to the OutdoorNav autonomy. It is
recommended that you first consult the following link(s) before
attempting to modify these parameters.

-   [Costmap2D/ObstacleLayer](http://wiki.ros.org/costmap_2d/hydro/obstacles)

| Environment Variable | Description                              | Data Type |
|----------------------|------------------------------------------|-----------|
| **COSTMAP\_LIDAR\_<2D/3D\>_OBSTACLE_RANGE** | The maximum range in meters at which to insert obstacles into the costmap using sensor data. This can apply for either 2D or 3D variables, associated with 2D and 3D lidars, respectively (front unit if more than one). | double |
| **COSTMAP\_LIDAR\_<2D/3D\>_RAYTRACE_RANGE** | The maximum range in meters at which to raytrace out obstacles from the map using sensor data. This can apply for either 2D or 3D variables, associated with 2D and 3D lidars, respectively (front unit if more than one). | double |
| **COSTMAP\_REAR_LIDAR\_<2D/3D\>_OBSTACLE_RANGE** | The maximum range in meters at which to insert obstacles into the costmap using sensor data. This can apply for either 2D or 3D variables, associated with 2D and 3D lidars, respectively (rear unit if more than one). | double |
| **COSTMAP\_REAR_LIDAR\_<2D/3D\>_RAYTRACE_RANGE** | The maximum range in meters at which to raytrace out obstacles from the map using sensor data. This can apply for either 2D or 3D variables, associated with 2D and 3D lidars, respectively (front unit if more than one). | double |
